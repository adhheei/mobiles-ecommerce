<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password - Jinsa Mobiles</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
      :root {
        --primary-black: #1a1a1a;
        --bg-light: #f8f9fa;
        --success-color: #198754;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
        --text-muted: #6c757d;
      }

      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--bg-light);
        height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0;
      }

      /* --- ANIMATION CSS --- */
      .reveal-up {
        opacity: 0;
        transform: translateY(30px);
        animation: revealUp 0.8s ease-out forwards;
      }

      @keyframes revealUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .pop-in {
        opacity: 0;
        transform: scale(0.5);
        animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        animation-delay: 0.2s;
      }

      @keyframes popIn {
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      /* -------------------- */

      .reset-card {
        background: #fff;
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        width: 100%;
        max-width: 420px;
        border: 1px solid #eee;
      }

      .brand-logo {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 20px;
        display: block;
        margin-left: auto;
        margin-right: auto;
      }

      .title {
        font-weight: 700;
        font-size: 1.5rem;
        margin-bottom: 5px;
        color: var(--primary-black);
        text-align: center;
      }

      .subtitle {
        font-size: 0.9rem;
        color: #6c757d;
        margin-bottom: 25px;
        text-align: center;
      }

      .form-group {
        position: relative;
        margin-bottom: 15px;
      }

      .form-control {
        padding: 12px 15px;
        border-radius: 8px;
        border: 1px solid #dee2e6;
        font-size: 0.9rem;
        background-color: #fcfcfc;
      }

      .form-control:focus {
        border-color: var(--primary-black);
        box-shadow: none;
        background-color: #fff;
      }

      .toggle-password {
        position: absolute;
        top: 14px; /* Adjusted based on input padding */
        right: 15px;
        cursor: pointer;
        color: #6c757d;
        font-size: 0.9rem;
      }

      /* Strength Meter Styles */
      .strength-meter-container {
        height: 4px;
        background-color: #e9ecef;
        border-radius: 2px;
        margin-top: 8px;
        overflow: hidden;
        display: flex;
      }

      .strength-bar {
        height: 100%;
        width: 0;
        transition: width 0.3s ease, background-color 0.3s ease;
        border-radius: 2px;
      }

      .strength-text {
        font-size: 0.75rem;
        margin-top: 4px;
        text-align: right;
        display: block;
        font-weight: 500;
        min-height: 18px; /* Prevent jump */
      }

      /* Password Strength Rules List */
      .password-rules {
        margin-top: 10px;
        margin-bottom: 20px;
        text-align: left;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #eee;
      }

      .rule-item {
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: color 0.3s;
      }

      .rule-item i {
        font-size: 0.7rem;
      }

      .rule-item.valid {
        color: var(--success-color);
        font-weight: 500;
      }

      .btn-reset {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        background: var(--primary-black);
        color: #fff;
        font-weight: 600;
        border: none;
        transition: 0.2s;
        font-size: 1rem;
        margin-top: 10px;
      }

      .btn-reset:hover {
        background: #333;
      }

      .btn-reset:disabled {
        background: #ccc;
        cursor: not-allowed;
      }
    </style>
  </head>
  <body>
    <div class="reset-card reveal-up">
      <img
        src="../images/logo.jpg"
        alt="Logo"
        class="brand-logo pop-in"
        onerror="this.src='https://placehold.co/80'"
      />

      <h2 class="title">Reset Password</h2>
      <p class="subtitle">Please create a strong password to secure your account.</p>

      <form onsubmit="handleReset(event)">
        
        <div class="form-group mb-4">
          <input
            type="password"
            class="form-control"
            placeholder="New Password"
            id="newPassword"
            onkeyup="checkStrength()"
            required
          />
          <i class="fa-regular fa-eye toggle-password" onclick="toggleVisibility('newPassword', this)"></i>
          
          <div class="strength-meter-container">
            <div class="strength-bar" id="strengthBar"></div>
          </div>
          <span class="strength-text" id="strengthText"></span>
        </div>

        <div class="form-group">
          <input
            type="password"
            class="form-control"
            placeholder="Confirm Password"
            id="confirmPassword"
            onkeyup="checkMatch()"
            required
          />
          <i class="fa-regular fa-eye toggle-password" onclick="toggleVisibility('confirmPassword', this)"></i>
        </div>

        <div class="password-rules">
          <div class="rule-item" id="rule-length">
            <i class="fa-solid fa-circle"></i> At least 8 characters
          </div>
          <div class="rule-item" id="rule-uppercase">
            <i class="fa-solid fa-circle"></i> At least one uppercase letter
          </div>
          <div class="rule-item" id="rule-number">
            <i class="fa-solid fa-circle"></i> At least one number
          </div>
          <div class="rule-item" id="rule-special">
            <i class="fa-solid fa-circle"></i> At least one special character (!@#$)
          </div>
          <div class="rule-item mt-2 pt-2 border-top" id="rule-match">
            <i class="fa-solid fa-circle"></i> Passwords match
          </div>
        </div>

        <button type="submit" class="btn-reset" id="submitBtn" disabled>Reset Password</button>
      </form>
    </div>

    <script>
      // Toggle Password Visibility
      function toggleVisibility(inputId, icon) {
        const input = document.getElementById(inputId);
        if (input.type === "password") {
          input.type = "text";
          icon.classList.remove("fa-eye");
          icon.classList.add("fa-eye-slash");
        } else {
          input.type = "password";
          icon.classList.remove("fa-eye-slash");
          icon.classList.add("fa-eye");
        }
      }

      // Check Password Strength
      function checkStrength() {
        const password = document.getElementById("newPassword").value;
        const bar = document.getElementById("strengthBar");
        const text = document.getElementById("strengthText");
        
        let score = 0;

        // Rules Regex
        const minLength = /.{8,}/;
        const hasUpper = /[A-Z]/;
        const hasNumber = /[0-9]/;
        const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/;

        // Update Rules List
        if(minLength.test(password)) { updateRule("rule-length", true); score++; } else updateRule("rule-length", false);
        if(hasUpper.test(password)) { updateRule("rule-uppercase", true); score++; } else updateRule("rule-uppercase", false);
        if(hasNumber.test(password)) { updateRule("rule-number", true); score++; } else updateRule("rule-number", false);
        if(hasSpecial.test(password)) { updateRule("rule-special", true); score++; } else updateRule("rule-special", false);

        // Update Strength Meter UI
        let width = 0;
        let color = "#e9ecef";
        let label = "";

        if (password.length > 0) {
            switch(score) {
                case 1:
                    width = 25;
                    color = "#dc3545"; // Red
                    label = "Weak";
                    text.style.color = "#dc3545";
                    break;
                case 2:
                    width = 50;
                    color = "#ffc107"; // Yellow
                    label = "Fair";
                    text.style.color = "#ffc107";
                    break;
                case 3:
                    width = 75;
                    color = "#0d6efd"; // Blue
                    label = "Good";
                    text.style.color = "#0d6efd";
                    break;
                case 4:
                    width = 100;
                    color = "#198754"; // Green
                    label = "Strong";
                    text.style.color = "#198754";
                    break;
                default:
                    width = 10;
                    color = "#dc3545";
                    label = "Very Weak";
            }
        }

        bar.style.width = width + "%";
        bar.style.backgroundColor = color;
        text.innerText = label;

        checkMatch(); // Re-check match whenever typing
      }

      // Check if passwords match
      function checkMatch() {
        const p1 = document.getElementById("newPassword").value;
        const p2 = document.getElementById("confirmPassword").value;
        const isMatch = p1 === p2 && p1 !== "";

        updateRule("rule-match", isMatch);
        toggleSubmitButton();
      }

      // Helper to update UI classes for Rules
      function updateRule(elementId, isValid) {
        const element = document.getElementById(elementId);
        const icon = element.querySelector("i");

        if (isValid) {
          element.classList.add("valid");
          icon.classList.remove("fa-circle");
          icon.classList.add("fa-check-circle");
        } else {
          element.classList.remove("valid");
          icon.classList.remove("fa-check-circle");
          icon.classList.add("fa-circle");
        }
      }

      // Enable submit button only if all rules passed
      function toggleSubmitButton() {
        const rules = document.querySelectorAll(".rule-item");
        const submitBtn = document.getElementById("submitBtn");
        
        // Check if all rules have the 'valid' class
        const allValid = Array.from(rules).every(rule => rule.classList.contains("valid"));
        
        submitBtn.disabled = !allValid;
      }

      // Handle Submit Action
      function handleReset(event) {
        event.preventDefault();
        
        Swal.fire({
          title: "Password Reset!",
          text: "Your password has been updated successfully.",
          icon: "success",
          confirmButtonColor: "#1a1a1a",
          confirmButtonText: "Login Now"
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = "adminLogin.html";
          }
        });
      }
    </script>
  </body>
</html>