<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <script src="/js/authGuard.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thank You - Jinsa Mobiles</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />

  <style>
    body {
      font-family: "Poppins", sans-serif;
      background-color: #fcfcfc;
      color: #1a1a1a;
    }

    .thank-you-container {
      max-width: 800px;
      margin: 60px auto;
      text-align: center;
      padding: 0 15px;
    }

    /* Added Animation */
    .reveal-up {
      opacity: 0;
      transform: translateY(30px);
      animation: revealUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    }

    @keyframes revealUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background-color: #28a745;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      margin: 0 auto 25px;
    }

    .order-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      text-align: left;
    }

    .order-card-header {
      padding: 20px 30px;
      border-bottom: 1px solid #eee;
    }

    .order-item-row {
      padding: 20px 30px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #eee;
    }

    .item-thumb {
      width: 60px;
      height: 70px;
      border-radius: 8px;
      object-fit: cover;
      margin-right: 20px;
    }

    .item-total {
      margin-left: auto;
      font-weight: 600;
    }

    .order-totals-row {
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }

    .order-totals-row.final {
      font-size: 1.1rem;
      font-weight: 700;
      border-top: 1px solid #eee;
    }

    .size-lg {
      font-size: 1.2rem;
      font-weight: 800;
    }

    .shipping-info-row {
      padding: 20px 30px;
      background: #f9f9f9;
      display: flex;
      justify-content: space-between;
      gap: 30px;
    }

    .action-buttons {
      margin-top: 40px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .btn-black {
      background: #1a1a1a;
      color: white;
      padding: 12px 30px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
    }

    .btn-outline {
      background: #e9ecef;
      padding: 12px 30px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      color: #1a1a1a;
    }
  </style>
</head>

<body>

  <div class="thank-you-container">
    <div class="success-icon">
      <i class="fa-solid fa-check"></i>
    </div>

    <h1>Thank You for Your Order!</h1>
    <p class="order-number-text text-muted mb-4"></p>

    <div class="order-card">
      <div class="order-card-header">
        <h5>Order Summary</h5>
        <p class="text-muted">A confirmation email has been sent.</p>
      </div>

      <!-- Items inserted dynamically -->

      <!-- Totals inserted dynamically -->

      <div class="shipping-info-row">
        <div class="info-column">
          <h6>Shipping Address</h6>
          <p></p>
        </div>
        <div class="info-column text-end">
          <h6>Estimated Delivery</h6>
          <p></p>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <a href="./userOrderDetails.html" class="btn-black">View Order History</a>
      <a href="/User/index.html" class="btn-outline">Continue Shopping</a>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ✅ FINAL FIXED SCRIPT -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {

      const summaryJSON = sessionStorage.getItem("lastOrderData");

      if (!summaryJSON) {
        // Fallback for demo or refreshing without order
        // alert("No order found"); 
        // window.location.href = "/User/index.html"; 
        return;
      }

      const order = JSON.parse(summaryJSON);
      const container = document.querySelector(".thank-you-container");
      container.classList.add("reveal-up"); // Trigger animation

      /* Order ID */
      document.querySelector(".order-number-text").innerText =
        `Your order #${order.orderId} has been successfully placed.`;

      /* Render Items */
      const card = document.querySelector(".order-card");
      const header = document.querySelector(".order-card-header");

      // Clear existing items if any (sanity check)
      document.querySelectorAll(".order-item-row").forEach(e => e.remove());

      order.items.forEach(item => {
        const row = document.createElement("div");
        row.className = "order-item-row";

        // Handle price display
        let priceHtml = "";
        const mrp = item.mrp || item.price; // Fallback to price if MRP missing
        const price = item.price;

        if (mrp > price) {
          priceHtml = `
                <del class="text-muted small me-2">Rs. ${mrp}</del>
                <span class="text-success fw-bold">Rs. ${price}</span>
             `;
        } else {
          priceHtml = `<span class="fw-bold">Rs. ${price}</span>`;
        }

        row.innerHTML = `
          <img src="${item.image}" class="item-thumb"
               onerror="this.src='https://placehold.co/100x100?text=No+Image'">
          <div style="flex-grow: 1;">
            <div class="fw-bold mb-1">${item.name}</div>
            <div class="text-muted small">Qty: ${item.quantity}</div>
            <div class="mt-1">${priceHtml}</div>
          </div>
          <div class="item-total fw-bold">Rs. ${item.price * item.quantity}</div>
        `;

        header.after(row);
      });

      /* Totals */
      const shippingRow = document.querySelector(".shipping-info-row");
      // Remove existing totals to prevent duplicates if any
      document.querySelectorAll(".order-totals-row").forEach(e => e.remove());

      const addTotal = (label, value, colorClass = "", bold = false) => {
        const row = document.createElement("div");
        row.className = `order-totals-row ${bold ? "final" : ""}`;
        row.innerHTML = `
          <span class="${bold ? "" : "text-muted"}">${label}</span>
          <span class="${colorClass} ${bold ? "fw-bold" : ""}">
            ${typeof value === "number" ? `Rs. ${value}` : value}
          </span>`;
        card.insertBefore(row, shippingRow); // Insert *before* shipping info
      };

      // 1. Total MRP
      if (order.totals.totalMrp && order.totals.totalMrp > order.totals.subtotal) {
        addTotal("Total MRP", order.totals.totalMrp);
      }

      // 2. Product Discount
      if (order.totals.productDiscount && order.totals.productDiscount > 0) {
        addTotal("Product Discount", `- Rs. ${order.totals.productDiscount}`, "text-success");
      }

      // 3. Subtotal (Deal Price)
      // addTotal("Subtotal", order.totals.subtotal); // Optional, maybe redundant if breakdown is clear

      // 4. Coupon Discount
      if (order.totals.couponDiscount && order.totals.couponDiscount > 0) {
        addTotal("Coupon Discount", `- Rs. ${order.totals.couponDiscount}`, "text-success");
      }

      // 5. Wallet
      if (order.totals.walletDeducted && order.totals.walletDeducted > 0) {
        addTotal("Wallet Paid", `- Rs. ${order.totals.walletDeducted}`, "text-success");
      }

      // 6. Shipping
      const shippingCost = order.totals.shipping === 0 ? "FREE" : order.totals.shipping;
      const shippingColor = order.totals.shipping === 0 ? "text-success fw-bold" : "";
      addTotal("Shipping", shippingCost, shippingColor);

      // 7. Total Payable
      addTotal("Total Payable", order.totals.totalAmount, "size-lg", true);


      /* Date Calculation */
      const start = new Date();
      start.setDate(start.getDate() + 6);
      const end = new Date();
      end.setDate(end.getDate() + 7);

      const format = d =>
        d.toLocaleDateString("en-IN", { weekday: 'short', day: "numeric", month: "short" });

      document.querySelector(".shipping-info-row .info-column:last-child p")
        .innerHTML = `<span class="fw-bold text-success">${format(start)} – ${format(end)}</span>`;

      /* Address */
      const a = order.address;
      if (a) {
        document.querySelector(".shipping-info-row .info-column p").innerHTML = `
            <div class="fw-bold text-dark">${a.fullName}</div>
            <div class="text-muted small">
                ${a.street}<br>
                ${a.city}, ${a.state} - ${a.pincode}<br>
                Phone: ${a.phone}
            </div>
        `;
      }

      // Optional cleanup
      sessionStorage.removeItem("lastOrderData");
    });
  </script>

</body>

</html>