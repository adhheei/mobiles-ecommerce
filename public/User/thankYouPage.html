<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <script src="/js/authGuard.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thank You - Jinsa Mobiles</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />

  <style>
    body {
      font-family: "Poppins", sans-serif;
      background-color: #fcfcfc;
      color: #1a1a1a;
    }

    .thank-you-container {
      max-width: 800px;
      margin: 60px auto;
      text-align: center;
      padding: 0 15px;
    }

    .success-icon {
      width: 80px;
      height: 80px;
      background-color: #28a745;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      margin: 0 auto 25px;
    }

    .order-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      text-align: left;
    }

    .order-card-header {
      padding: 20px 30px;
      border-bottom: 1px solid #eee;
    }

    .order-item-row {
      padding: 20px 30px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid #eee;
    }

    .item-thumb {
      width: 60px;
      height: 70px;
      border-radius: 8px;
      object-fit: cover;
      margin-right: 20px;
    }

    .item-total {
      margin-left: auto;
      font-weight: 600;
    }

    .order-totals-row {
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }

    .order-totals-row.final {
      font-size: 1.1rem;
      font-weight: 700;
      border-top: 1px solid #eee;
    }

    .shipping-info-row {
      padding: 20px 30px;
      background: #f9f9f9;
      display: flex;
      justify-content: space-between;
      gap: 30px;
    }

    .action-buttons {
      margin-top: 40px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .btn-black {
      background: #1a1a1a;
      color: white;
      padding: 12px 30px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
    }

    .btn-outline {
      background: #e9ecef;
      padding: 12px 30px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      color: #1a1a1a;
    }
  </style>
</head>

<body>

  <div class="thank-you-container">
    <div class="success-icon">
      <i class="fa-solid fa-check"></i>
    </div>

    <h1>Thank You for Your Order!</h1>
    <p class="order-number-text text-muted mb-4"></p>

    <div class="order-card">
      <div class="order-card-header">
        <h5>Order Summary</h5>
        <p class="text-muted">A confirmation email has been sent.</p>
      </div>

      <!-- Items inserted dynamically -->

      <!-- Totals inserted dynamically -->

      <div class="shipping-info-row">
        <div class="info-column">
          <h6>Shipping Address</h6>
          <p></p>
        </div>
        <div class="info-column text-end">
          <h6>Estimated Delivery</h6>
          <p></p>
        </div>
      </div>
    </div>

    <div class="action-buttons">
      <a href="./userOrderDetails.html" class="btn-black">View Order History</a>
      <a href="./index.html" class="btn-outline">Continue Shopping</a>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ✅ FINAL FIXED SCRIPT -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {

      const summaryJSON = sessionStorage.getItem("checkoutSummary");

      if (!summaryJSON) {
        alert("No order found");
        window.location.href = "/index.html";
        return;
      }

      const order = JSON.parse(summaryJSON);

      /* Order ID */
      document.querySelector(".order-number-text").innerText =
        `Your order #${order.orderId} has been successfully placed.`;

      /* Render Items */
      const card = document.querySelector(".order-card");
      const header = document.querySelector(".order-card-header");

      order.items.forEach(item => {
        const row = document.createElement("div");
        row.className = "order-item-row";

        row.innerHTML = `
          <img src="${item.image}" class="item-thumb"
               onerror="this.src='https://placehold.co/100x100?text=No+Image'">
          <div>
            <strong>${item.name}</strong><br>
            Qty: ${item.quantity}<br>
            <del class="text-muted">Rs. ${item.mrp}</del>
            <span class="text-success ms-2">Rs. ${item.price}</span>
          </div>
          <div class="item-total">Rs. ${item.price * item.quantity}</div>
        `;

        header.after(row);
      });

      /* Totals */
      const shippingRow = document.querySelector(".shipping-info-row");

      const addTotal = (label, value, green = false, bold = false) => {
        const row = document.createElement("div");
        row.className = `order-totals-row ${bold ? "final" : ""}`;
        row.innerHTML = `
          <span>${label}</span>
          <span class="${green ? "text-success" : ""}">
            ${typeof value === "number" ? `Rs. ${value}` : value}
          </span>`;
        card.insertBefore(row, shippingRow);
      };

      addTotal("Total MRP", order.pricing.mrpTotal);
      addTotal("Product Discount", `- Rs. ${order.pricing.discount}`, true);

      if (order.pricing.couponDiscount > 0) {
        addTotal("Coupon Discount", `- Rs. ${order.pricing.couponDiscount}`, true);
      }

      addTotal("Shipping", "FREE", true);
      addTotal("Total Payable", order.pricing.finalAmount, false, true);

      /* Delivery Date (6–7 days) */
      const start = new Date();
      start.setDate(start.getDate() + 6);
      const end = new Date();
      end.setDate(end.getDate() + 7);

      const format = d =>
        d.toLocaleDateString("en-IN", { day: "numeric", month: "long" });

      document.querySelector(".shipping-info-row .info-column:last-child p")
        .innerText = `${format(start)} – ${format(end)}`;

      /* Address */
      const a = order.address;
      document.querySelector(".shipping-info-row .info-column p").innerHTML = `
        <strong>${a.fullName}</strong><br>
        ${a.street}<br>
        ${a.city}, ${a.state} - ${a.pincode}<br>
        Phone: ${a.phone}
      `;

      // Optional cleanup
      sessionStorage.removeItem("checkoutSummary");
    });
  </script>

</body>

</html>